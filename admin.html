<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin - OmniSearch</title>
    <link rel="stylesheet" href="admin-style.css">
</head>
<body>

    <aside class="sidebar">
        <div class="brand">
            <h3>‚öôÔ∏è OmniAdmin</h3>
        </div>
        <nav>
            <ul>
                <li class="active"><a href="#">Tableau de Bord</a></li>
                <li><a href="#" style="opacity:0.5; cursor:not-allowed">Analytiques (Bient√¥t)</a></li>
                <li><a href="#" style="opacity:0.5; cursor:not-allowed">Logs API (Bient√¥t)</a></li>
            </ul>
        </nav>
        <div class="logout-area">
            <button onclick="logout()" class="btn-logout">D√©connexion</button>
        </div>
    </aside>

    <main class="main-content">
        <header>
            <h1>Vue d'ensemble</h1>
            <a href="index.html" target="_blank" class="view-site-link">Voir le site en direct ‚Üó</a>
        </header>

        <div class="dashboard-grid">
            
            <div class="card">
                <div class="card-header">
                    <h2>üö¶ √âtat du Syst√®me</h2>
                </div>
                <div class="card-body">
                    <div class="toggle-item">
                        <div class="toggle-info">
                            <strong>Maintenance Globale</strong>
                            <p>Ferme l'acc√®s complet au site public.</p>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="site-maintenance-toggle">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    
                    <hr>

                    <div class="toggle-item">
                        <div class="toggle-info">
                            <strong>Maintenance IA</strong>
                            <p>D√©sactive uniquement la recherche (API Groq).</p>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="ia-maintenance-toggle">
                            <span class="slider round"></span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2>üö´ Gestion des Bannissements</h2>
                </div>
                <div class="card-body">
                    <div class="input-group">
                        <input type="text" id="block-input" placeholder="Nom d'utilisateur...">
                        <button onclick="blockUser()" class="btn-secondary">Bloquer</button>
                    </div>
                    
                    <div class="blocked-list-container">
                        <h4>Liste noire :</h4>
                        <ul id="blocked-list">
                            </ul>
                        <button onclick="clearBlockedUsers()" class="btn-text">Tout d√©bloquer</button>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <script>
        // --- LOGIQUE ADMIN ---

        // 1. V√âRIFICATION DE S√âCURIT√â
        if (localStorage.getItem('isLoggedIn') !== 'true') {
            window.location.href = 'login.html';
        }

        // Constantes (Doivent correspondre √† index.html)
        const STORAGE_MAINTENANCE_SITE = 'siteMaintenance';
        const STORAGE_MAINTENANCE_IA = 'iaMaintenance';
        const STORAGE_BLOCKED_USERS = 'blockedUsers';

        // 2. CHARGEMENT DES DONN√âES
        document.addEventListener('DOMContentLoaded', () => {
            // Checkbox Maintenance
            document.getElementById('site-maintenance-toggle').checked = localStorage.getItem(STORAGE_MAINTENANCE_SITE) === 'true';
            document.getElementById('ia-maintenance-toggle').checked = localStorage.getItem(STORAGE_MAINTENANCE_IA) === 'true';
            
            // Liste bloqu√©e
            renderBlockedList();

            // √âcouteurs d'√©v√©nements (Sauvegarde automatique)
            document.getElementById('site-maintenance-toggle').addEventListener('change', function() {
                localStorage.setItem(STORAGE_MAINTENANCE_SITE, this.checked);
            });
            document.getElementById('ia-maintenance-toggle').addEventListener('change', function() {
                localStorage.setItem(STORAGE_MAINTENANCE_IA, this.checked);
            });
        });

        // 3. FONCTIONS UTILISATEURS
        function blockUser() {
            const input = document.getElementById('block-input');
            const username = input.value.trim();
            if (!username) return;

            let list = JSON.parse(localStorage.getItem(STORAGE_BLOCKED_USERS) || '[]');
            if (!list.includes(username)) {
                list.push(username);
                localStorage.setItem(STORAGE_BLOCKED_USERS, JSON.stringify(list));
                renderBlockedList();
            }
            input.value = '';
        }

        function renderBlockedList() {
            const list = JSON.parse(localStorage.getItem(STORAGE_BLOCKED_USERS) || '[]');
            const ul = document.getElementById('blocked-list');
            ul.innerHTML = '';
            
            if (list.length === 0) {
                ul.innerHTML = '<li class="empty-msg">Aucun utilisateur bloqu√©.</li>';
                return;
            }

            list.forEach(user => {
                const li = document.createElement('li');
                li.textContent = user;
                ul.appendChild(li);
            });
        }

        function clearBlockedUsers() {
            if(confirm('Voulez-vous vraiment d√©bloquer tout le monde ?')) {
                localStorage.removeItem(STORAGE_BLOCKED_USERS);
                renderBlockedList();
            }
        }

        // 4. D√âCONNEXION
        function logout() {
            localStorage.removeItem('isLoggedIn');
            window.location.href = 'login.html';
        }
    </script>
</body>
</html>